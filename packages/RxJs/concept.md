# ä»‹ç»

## ä»€ä¹ˆæ˜¯ Rx?

> **Ractive Extension** ä¹Ÿå« **ReactiveX**,æˆ–è€…ç®€ç§°`Rx`,æŒ‡çš„æ˜¯å®žè·µå“åº”å¼ç¼–ç¨‹çš„ä¸€å¥—å·¥å…·ã€‚Rx æ˜¯ä¸€ä¸ªå¤§å®¶æ—å®ƒåŒ…å« RxJavaã€RxPy ç­‰ï¼Œ`RxJSæ˜¯Rxç”¨JavaScriptè¯­è¨€å®žçŽ°`ã€‚

RxJs æ“…é•¿å¤„ç†å¼‚æ­¥æ“ä½œ,å› ä¸ºå®ƒé‡‡ç”¨`æŽ¨`çš„å¤„ç†æ–¹å¼,å½“ä¸€ä¸ªæ•°æ®äº§ç”Ÿæ—¶ï¼Œè¢«æŽ¨é€ç»™å¯¹åº”çš„å¤„ç†å‡½æ•°,è€Œè¿™ä¸ªå¤„ç†å‡½æ•°`ä¸ç”¨å…³å¿ƒæ•°æ®æ˜¯åŒæ­¥äº§ç”Ÿè¿˜æ˜¯å¼‚æ­¥äº§ç”Ÿ`çš„ã€‚å› æ­¤å­¦ä¹  RxJS å°±æ˜¯å­¦ä¹ å¦‚ä½•ç»„åˆæ“ä½œç¬¦æ¥è§£å†³å¤æ‚é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹:

1.  RxJS æ˜¯ä½¿ç”¨ `Observables çš„å“åº”å¼ç¼–ç¨‹çš„åº“`ï¼Œå®ƒä½¿ç¼–å†™å¼‚æ­¥æˆ–åŸºäºŽå›žè°ƒçš„ä»£ç æ›´å®¹æ˜“ã€‚
2.  å¯ä»¥å°†å®ƒçœ‹ä½œä¸€ä¸ªäº‹ä»¶å¤„ç†çš„ Lodash
3.  ReactiveX å°†`è§‚å¯Ÿè€…æ¨¡å¼`ä¸Ž`è¿­ä»£å™¨æ¨¡å¼`ä»¥åŠå‡½æ•°ç¼–ç¨‹ç›¸ç»“åˆï¼Œä»Žè€Œæ»¡è¶³äº†ç®¡ç†äº‹ä»¶åºåˆ—çš„ç†æƒ³æ–¹å¼çš„éœ€æ±‚ã€‚

**å‡½æ•°ç¼–ç¨‹ç‰¹ç‚¹**

- çº¯å‡½æ•°
- å£°æ˜Žå¼
- æ•°æ®ä¸å¯å˜æ€§

**å‡½æ•°å“åº”å¼ç¼–ç¨‹ä¼˜åŠ¿** 5. æ•°æ®æµæŠ½è±¡äº†å¾ˆå¤šçŽ°å®žé—®é¢˜ 6. æ“…é•¿å¤„ç†å¼‚æ­¥æ“ä½œ 7. æŠŠå¤æ‚é—®é¢˜åˆ†è§£æˆç®€å•é—®é¢˜çš„ç»„åˆ

### pull ä¸Ž push

pull å’Œ push æ˜¯ä¸¤ç§ä¸åŒçš„åè®®,å®ƒä»¬æè¿°äº†æ•°æ®ç”Ÿäº§è€…(Producer)å¦‚ä½•æ•°æ®æ¶ˆè´¹è€…(Consumer)é€šä¿¡

- `pull`:åœ¨ pull ç³»ç»Ÿä¸­`Consumer`æ˜Žç¡®çŸ¥é“ä½•æ—¶ä»Ž`Producer`ä¸­æŽ¥æ”¶æ•°æ®,ä½†æ˜¯`Producer`ä¸çŸ¥é“ä½•æ—¶å°†æ•°æ®å‘é€ç»™`Consumer`ã€‚æ¯ä¸ª JavaScript å‡½æ•°éƒ½æ˜¯ä¸€ä¸ª Pull ç³»ç»Ÿã€‚è¯¥å‡½æ•°æ˜¯æ•°æ®çš„ç”Ÿäº§è€…ï¼Œå¹¶ä¸”è°ƒç”¨è¯¥å‡½æ•°çš„ä»£ç é€šè¿‡ä»Žè°ƒç”¨ä¸­â€œæ‹‰å‡ºâ€ å•ä¸ªè¿”å›žå€¼æ¥ä½¿ç”¨å®ƒã€‚

|      | Producer                  | Consumer                    |
| ---- | ------------------------- | --------------------------- |
| pull | è¢«åŠ¨:åœ¨éœ€è¦æ—¶äº§ç”Ÿæ•°æ®ã€‚   | ä¸»åŠ¨:å†³å®šä½•æ—¶è¯·æ±‚æ•°æ®ã€‚     |
| push | ä¸»åŠ¨:è‡ªå·±çš„èŠ‚å¥ç”Ÿæˆæ•°æ®ã€‚ | è¢«åŠ¨:å¯¹æ”¶åˆ°å¯¹æ•°æ®åšååº”å¤„ç† |

- `push`:åœ¨æŽ¨é€ç³»ç»Ÿä¸­ï¼Œç”Ÿäº§è€…ç¡®å®šä½•æ—¶å°†æ•°æ®å‘é€ç»™æ¶ˆè´¹è€…ã€‚æ¶ˆè´¹è€…ä¸çŸ¥é“ä½•æ—¶æŽ¥æ”¶è¯¥æ•°æ® Promise æ˜¯å½“ä»Š JavaScript ä¸­æœ€å¸¸è§çš„ Push ç³»ç»Ÿç±»åž‹ã€‚

RxJs å¼•å…¥ Observables è¿™æ˜¯ä¸€ä¸ªç”¨äºŽ JavaScript çš„æ–° Push ç³»ç»Ÿ,ä¸€ä¸ª Observable æ˜¯å¤šä¸ªå€¼çš„ç”Ÿäº§è€…ï¼Œå°†å®ƒä»¬â€œæŽ¨é€â€åˆ°è§‚å¯Ÿè€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚

### Observable ä¸Ž Observer

`Observable` å°±æ˜¯"å¯ä»¥è¢«è§‚å¯Ÿçš„å¯¹è±¡"å³`è¢«è§‚å¯Ÿè€…`,è€Œ`Observer`å°±æ˜¯`è§‚å¯Ÿè€…`,è¿žæŽ¥ä»–ä»¬çš„æ¡¥æ¢å°±æ˜¯`Observableå¯¹è±¡çš„å‡½æ•° subscribe`ã€‚

> RxJs çš„æ•°æ®æµå°±æ˜¯ Observable å¯¹è±¡,é‡‡ç”¨äº† è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼

#### è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼ç”¨å°†é€»è¾‘åˆ†ä¸ºå‘å¸ƒè€…å’Œè§‚å¯Ÿè€…ã€‚

- å…¶ä¸­å‘å¸ƒè€…åªç®¡è´Ÿè´£äº§ç”Ÿäº‹ä»¶,å®ƒä¼šé€šçŸ¥æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…,è€Œä¸å…³å¿ƒè¿™äº›è§‚å¯Ÿè€…æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶ã€‚
- è§‚å¯Ÿè€…å¯ä»¥è¢«æ³¨å†Œä¸ŠæŸä¸ªå‘å¸ƒè€…,åªç®¡æŽ¥æ”¶åˆ°äº‹ä»¶ä¹‹åŽçš„å¤„ç†,è€Œä¸å…³å¿ƒè¿™äº›æ•°æ®æ˜¯å¦‚ä½•äº§ç”Ÿã€‚

```js
import { Observable } from 'rxjs';
//å‘å¸ƒè€… äº§ç”Ÿäº‹ä»¶
const observable = new Observable((subscriber) => {
  subscriber.next('hello RxJs');
  subscriber.next('hi!');
});
//è§‚å¯Ÿè€…æŽ¥æ”¶äº‹ä»¶
observable.subscribe(console.log);
```

#### è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨æ˜¯æŒ‡èƒ½å¤ŸéåŽ†ä¸€ä¸ªæ•°æ®é›†åˆçš„å¯¹è±¡,ç”±äºŽæ•°æ®é›†åˆæœ‰å¤šç§:æ•°ç»„ã€æ ‘å½¢ç»“æž„ã€å•å‘é“¾è¡¨...ã€‚è¿­ä»£å™¨ä½œç”¨å°±æ˜¯æä¾›é€šç”¨çš„æŽ¥å£,è®©æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸ç”¨å…³å¿ƒè¿™ä¸ªæ•°æ®é›†åˆå®žçŽ°å½¢å¼ã€‚

#### ç»“è®º

> RxJs ä¸­ï¼Œä½œä¸ºè¿­ä»£å™¨çš„ä½¿ç”¨è€…,æˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸»åŠ¨åŽ»ä»Ž Observable ä¸­"pull"æ•°æ®,æˆ‘ä»¬åªéœ€è¦ subscribe åŽ,è‡ªç„¶å°±èƒ½å¤ŸæŽ¥æ”¶åˆ°æ¶ˆæ¯æŽ¨é€(`push`)ã€‚

### Hot Observable ä¸Ž Cold Observable

è¿™ä¸¤è€…éƒ½æ˜¯å¯¹äºŽ Observable å¯¹è±¡æœ‰æœ‰å¤šå¯¹è±¡è®¢é˜…æ—¶,åŽè€…å¯¹äºŽå‰è€…æ•°æ®å¤„ç†çš„ä¸åŒå½¢å¼ã€‚

- Hot Observable: å½“åŽè€…è®¢é˜…æ—¶,å¯¹äºŽé”™è¿‡çš„æ•°æ®ä¸åœ¨è®¢é˜…ä»Žæœ€æ–°çš„å¼€å§‹è®¢é˜…ã€‚

> å¯¹äºŽ Hot Observable æ¦‚å¿µä¸Šæ˜¯æœ‰ä¸€ä¸ªç‹¬ç«‹äºŽ`Observable`å¯¹è±¡çš„*ç”Ÿäº§è€…*,è€Œè¿™ä¸ª*ç”Ÿäº§è€…*çš„åˆ›å»ºå’Œ`subscribe`è°ƒç”¨æ²¡æœ‰å…³ç³»ã€‚

```js
const producer = new Producer();
const hot$ = new Observable((observer) => {
  //è®©observable åŽ»æŽ¥å—produceräº§ç”Ÿçš„æ•°æ®
});
```

- Cold Observable: å½“åŽè€…è®¢é˜…æ—¶,å¯¹äºŽå·²ç»é”™è¿‡çš„æ•°æ®ä»Žæ–°å¼€å§‹è®¢é˜…ã€‚

> æ¯ä¸€ä¸ª Cold Observable å¯ä»¥è®¤ä¸ºå®ƒå¯¹æ¯ä¸€æ¬¡`subscribe`éƒ½äº§ç”Ÿä¸€ä¸ª`ç”Ÿäº§è€…`,ç„¶åŽå¯¹è¿™ä¸ªç”Ÿäº§è€…çš„æ•°æ®é€šè¿‡*next*å‡½æ•°ä¼ é€’ç»™è®¢é˜…çš„`è§‚å¯Ÿè€…(Observer)`

```js
const cold$ = new Observable((observer) => {
  //äº§ç”Ÿæ•°æ®
  const producer = new Producer();
  //...
});
```

## èµ°è¿‘ RxJs

`RXJSä¸€äº›æ¦‚å¿µ`:

- Observable:è¡¨ç¤ºæœªæ¥å¯ä»¥è°ƒç”¨çš„å€¼æˆ–è€…é›†åˆ
- Observer:ä¸€ç»„å›žè°ƒ,ç”¨æ¥ç›‘å¬ Observable ä¼ é€’çš„å€¼
- Subscription:è¡¨ç¤º Observable çš„æ‰§è¡Œï¼Œä¸»è¦ç”¨äºŽå–æ¶ˆæ‰§è¡Œ
- Operators:æ˜¯ä¸€ä¸ªçº¯å‡½æ•°,å®ƒå°†ä¸€ä¸ª Observable ä½œä¸ºè¾“å…¥å¹¶ç”Ÿæˆå¦ä¸€ä¸ª Observable ä½œä¸ºè¾“å‡º
- Subject:ç­‰åŒäºŽ EventEmitterï¼Œå¹¶ä¸”æ˜¯å°†å€¼æˆ–äº‹ä»¶å¤šæ’­åˆ°å¤šä¸ªè§‚å¯Ÿè€…çš„å”¯ä¸€æ–¹æ³•
- Schedulers:æ˜¯é›†ä¸­å¼æŽ§åˆ¶å¹¶å‘è°ƒåº¦

é¦–å…ˆç»™ä¸€ä¸ªæ„Ÿå®˜ä¸Šé¢çš„è®¤çŸ¥ï¼Œç›®å‰ä¸å¿…äº†è§£å…·ä½“å†…å®¹åªéœ€è¦çŸ¥é“å®ƒæœ‰é‚£äº›åŽç»­æˆ‘ä»¬æ¥ä¸€èµ·é€ä¸ªæ”»ç ´ ðŸ’ªã€‚

### æ­å»ºå­¦ä¹ ä»“åº“

> npm init -y npm typescript ts-node ts-node-dev -D

> npm i rxjs @types/node @types/es6-shim

> npx tsc --init

`tsconfig.json`

```json
 "outDir": "./dist",    //æ‰“å¼€è¯¥è¡Œ
```

`package.json`

```json
"scripts": {
    "build-ts": "tsc",
    "dev": "ts-node-dev --respawn --transpileOnly ./src/index.ts"
  },
```

### å°è¯•ç‰›åˆ€

```js
import { Observable } from 'rxjs';

const observable = new Observable((subscriber) => {
  subscriber.next(1);
  subscriber.next(2);
  subscriber.next(3);
  setTimeout(() => {
    subscriber.next(4);
    subscriber.complete();
  }, 1000);
});

console.log('just before subscribe');
observable.subscribe({
  next(x) {
    console.log('got value ' + x);
  },
  error(err) {
    console.error('something wrong occurred: ' + err);
  },
  complete() {
    console.log('done');
  },
});
console.log('just after subscribe');
```

> npm run dev

[è¿”å›ž](./README.md)

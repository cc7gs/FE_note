(self["webpackChunkFE_note"]=self["webpackChunkFE_note"]||[]).push([[7836],{1422:e=>{"use strict";e.exports={}},3859:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>s});const s={}},6682:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>o});var s=r(7294),t=r(6584),i=r(2196);r(3859);const o=e=>(s.useEffect((()=>{null!==e&&void 0!==e&&e.location.hash&&t.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),s.createElement(s.Fragment,null,s.createElement("div",{className:"markdown"},s.createElement("h1",{id:"redis\u4ecb\u7ecd"},s.createElement(t.AnchorLink,{to:"#redis\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"redis\u4ecb\u7ecd"),s.createElement("ul",null,s.createElement("li",null,"redis\u53ef\u7528\u4f5c\u6570\u636e\u5e93\u3001\u9ad8\u901f\u7f13\u5b58\u548c\u6d88\u606f\u961f\u5217\u4ee3\u7406,\u5e76\u975e\u5e38\u9002\u5408\u5904\u7406\u77ed\u65f6\u95f4\u5185\u88ab\u9ad8\u9891\u8bbf\u95ee\u4f46\u53c8\u4e0d\u9700\u8981\u957f\u671f\u8bbf\u95ee\u7684\u7b80\u5355\u6570\u636e\u5b58\u50a8\u3002"),s.createElement("li",null,"redis\u662f\u65e2\u53ef\u4ee5\u57fa\u4e8e\u5185\u5b58\u4e5f\u53ef\u4ee5\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578bKey-Value\u6570\u636e\u5e93,\u5e76\u652f\u6301\u591a\u79cd\u8bed\u8a00\u7684API,\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\u3002")),s.createElement("h2",{id:"\u5b89\u88c5redis\uff08windows\uff09"},s.createElement(t.AnchorLink,{to:"#\u5b89\u88c5redis\uff08windows\uff09","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5redis\uff08windows\uff09"),s.createElement("p",null,s.createElement(t.Link,{to:"https://github.com/MicrosoftArchive/redis/releases"},"gitHub")),s.createElement("p",null,"\u5177\u4f53\u6b65\u9aa4\u53c2\u8003\u4e0b\u9762\u94fe\u63a5:",s.createElement(t.Link,{to:"https://www.cnblogs.com/cang12138/p/8880776.html"},"\u53c2\u8003\u539f\u6587")),s.createElement("p",null,s.createElement("strong",null,"\u5e38\u7528\u547d\u4ee4:"),"\u5378\u8f7d\u670d\u52a1\uff1aredis-server --service-uninstall \u5f00\u542f\u670d\u52a1\uff1aredis-server --service-start \u505c\u6b62\u670d\u52a1\uff1aredis-server --service-stop \u542f\u52a8Redis\u547d\u4ee4\u884c\u5de5\u5177: redis-cli"),s.createElement("p",null,s.createElement("strong",null,"\u8fde\u63a5\u8fdc\u7a0bRedis\u670d\u52a1")),s.createElement("blockquote",null,s.createElement("p",null,"redis-cli -h host -p port -a password")),s.createElement("p",null,"host\u662f\u4e3b\u673a\u540d,port \u662f\u7aef\u53e3\u53f7,password\u662f\u8fdc\u7a0b\u670d\u52a1\u5668\u5bc6\u7801"),s.createElement("h2",{id:"node\u4e2d\u4f7f\u7528"},s.createElement(t.AnchorLink,{to:"#node\u4e2d\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"node\u4e2d\u4f7f\u7528"),s.createElement("blockquote",null,s.createElement("p",null,"npm i redis --save")),s.createElement(i.Z,{code:"const redis = require('redis');\r\n//\u8fde\u63a5\u672c\u5730Redis\u670d\u52a1\r\nconst client = redis.createClient(6379, '127.0.0.1');\r\n//\u64cd\u4f5credis\r\n//1. \u5b57\u7b26\u4e32\r\nclient.set('name', 'cc', redis.print); //redis.print \u6253\u5370\u8bbe\u7f6e\u7684\u6570\u636e\u7ed3\u679c\r\nclient.get('name', (err, value) => {\r\n  if (err) throw err;\r\n  console.log('Name:', value);\r\n});\r\n//2.\u54c8\u5e0c\u503c(Hash)\r\nclient.hmset('person', { //\u5b58\u50a8\u4e00\u4e2a\u5bf9\u8c61\r\n  'name': 'cc',\r\n  'age': 24\r\n});\r\nclient.hgetall('person', (err, obj) => {\r\n  if (err) throw err;\r\n  console.log('\u901a\u8fc7Hash\u5b58\u50a8:', obj);\r\n});\r\n\r\n//3. \u96c6\u5408(Set)\r\nclient.sadd('address', '\u4e0a\u6d77', redis.print);\r\nclient.sadd('address', '\u5317\u4eac', redis.print);\r\nclient.sadd('address', '\u897f\u5b89', redis.print);\r\nclient.sadd('address', '\u5e7f\u5dde', redis.print);\r\n//\u83b7\u53d6\u96c6\u5408\u7684\u503c\r\nclient.smembers('address', (err, members) => {\r\n  if (err) throw err;\r\n  console.log('\u83b7\u53d6\u96c6\u5408\u7684\u503c:', members);\r\n})\r\n//4. List  \r\n//lpush\u5411\u5217\u8868\u4e2d\u6dfb\u52a0\u503c\r\n// lrange \u83b7\u53d6\u53c2\u6570 start-end\u8303\u56f4\u5185\u7684\u5217\u8868\u5143\u7d20\r\n\r\nclient.lpush('animal', 'dog', redis.print);\r\nclient.lpush('animal', 'cat', redis.print);\r\nclient.lpush('animal', 'pig', redis.print);\r\nclient.lrange('animal', 0, 1, (err, items) => {\r\n  if (err) throw err;\r\n  items.forEach((item, i) => {\r\n    console.log(`\u83b7\u53d6List\u5185\u5bb9\u3001i-item:${i}-${item}`);\r\n  })\r\n});\r\n\r\nclient.on('error', err => {\r\n  console.log('redis clinet Error', err);\r\n})",lang:"javascript"}),s.createElement("h1",{id:"session"},s.createElement(t.AnchorLink,{to:"#session","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"Session"),s.createElement("p",null,"\u5b83\u662f\u7528\u4e8e\u63a7\u5236\u7f51\u7edc\u4f1a\u8bdd\u7684,\u5982\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u3001\u8d2d\u7269\u8f66\u4e2d\u5546\u54c1\u7b49\u3002Session\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef,\u5728\u670d\u52a1\u7aef\u6709\u5f88\u591a\u5b58\u50a8\u65b9\u5f0f,\u5b83\u53ef\u4ee5\u4fdd\u5b58\u5728\u5185\u5b58\u3001(Redis\u3001MongoDB)\u7b49\u6570\u636e\u5e93\u4e2d\u3001\u6587\u4ef6\u4e2d\u3002 \u5728\u5ba2\u6237\u7aef\u901a\u8fc7Cookie\u6765\u4fdd\u5b58Session\u7684\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6,\u4f7f\u7528Cookie\u7684\u539f\u56e0\u662f\u6bcf\u4e2aHTTP\u8bf7\u6c42\u5934\u90fd\u53ef\u4ee5\u5e26\u4e0aCookie\u4fe1\u606f,\u5e76\u53ef\u4ee5 ",s.createElement("strong",null,"\u8bbe\u7f6eHtppOnly=true"),"\u9632\u6b62\u5ba2\u6237\u7aef\u7be1\u6539Cookie."),s.createElement("h2",{id:"node\u4e2d\u5e94\u7528"},s.createElement(t.AnchorLink,{to:"#node\u4e2d\u5e94\u7528","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"node\u4e2d\u5e94\u7528"),s.createElement("blockquote",null,s.createElement("p",null,"npm install koa-session")),s.createElement(i.Z,{code:"const Koa=require('koa');\r\nconst app=new Koa();\r\nconst session=require('koa-session');\r\nconst secretSessionKey='secert_key';\r\napp.keys=[secretSessionKey]; //\u8bbe\u7f6e\u7b7e\u540dCookie\u79d8\u94a5\r\nconst CONFIG={\r\n  key:'myAppSessKey', //Cookie\u4e2d\u7684key\r\n  maxAge:'3600000', //\u5931\u6548\u65f6\u95f4 \u5355\u4f4dms\r\n  overwrite:true,   //\u662f\u5426\u53ef\u4ee5\u8986\u76d6\r\n  httpOnly:true, //\u662f\u5426\u7981\u6b62\u5ba2\u6237\u7aef\u7be1\u6539\r\n  signed:true  //\u7b7e\u540d\u662f\u5426\u5f00\u542f\r\n}\r\napp.use(session(CONFIG,app)); //\u52a0\u8f7dsession \u4e2d\u95f4\u4ef6\r\napp.use(async ctx=>{\r\n  if(ctx.path==='/favicon.ico') return;\r\n  console.log(ctx.session,'views')\r\n  let n=ctx.session.views || 0;\r\n  ctx.session.views=++n;\r\n  ctx.body=`${n} \u7f51\u7ad9\u52a0\u8f7d\u6b21\u6570 views`;\r\n})\r\napp.listen(3000,()=>{\r\n  console.log('app listen at port 3000');\r\n})",lang:"javascript"}),s.createElement("h2",{id:"redis\u5b58\u50a8session"},s.createElement(t.AnchorLink,{to:"#redis\u5b58\u50a8session","aria-hidden":"true",tabIndex:-1},s.createElement("span",{className:"icon icon-link"})),"redis\u5b58\u50a8Session"),s.createElement(i.Z,{code:"const Koa = require('koa');\r\nconst app = new Koa();\r\nconst session = require('koa-session');\r\nconst redis = require('redis');\r\nconst client = redis.createClient(6379, '127.0.0.1'); //\u8fde\u63a5\u672c\u673aRedis\u670d\u52a1\r\nconst secretSessionKeys = 'secret_session';\r\nconst { promisify } = require('util');\r\nconst hgetllAsync = promisify(client.hgetall).bind(client);\r\n\r\napp.keys = [secretSessionKeys];\r\nconst store = {\r\n  get: async (key,maxAge)=>{\r\n    const result= await hgetllAsync(key);\r\n  },\r\n  set: (key, sess, maxAge) => {  //\u5b58\u50a8Session\r\n    client.hmset(key, sess);\r\n  },\r\n  destroy: (key) => {  //\u9500\u6bc1\r\n    client.hdel(key);\r\n  }\r\n}\r\nconst CONFIG = {\r\n  key: 'session_redis',\r\n  maxAge: 3600000,\r\n  overwrite: true,\r\n  httpOnly: true,\r\n  signed: true,\r\n  store\r\n};\r\napp.use(session(CONFIG, app)); //\u4f7f\u7528session\u4e2d\u95f4\u4ef6\r\napp.use(ctx => {\r\n  if (ctx.path === '/favicon.ico') return;\r\n  let n = ctx.session.views || 0;\r\n  ctx.session.views = ++n;\r\n  ctx.body = `${n} views`;\r\n})\r\napp.listen(3000, () => {\r\n  console.log('app listen at 3000');\r\n})",lang:"javascript"}))))}}]);
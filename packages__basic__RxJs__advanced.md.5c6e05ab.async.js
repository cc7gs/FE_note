(self["webpackChunkFE_note"]=self["webpackChunkFE_note"]||[]).push([[1109],{1422:e=>{"use strict";e.exports={}},3859:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>t});const t={}},8975:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>c});var t=r(7294),o=r(6584),l=r(2196);r(3859);const c=e=>(t.useEffect((()=>{null!==e&&void 0!==e&&e.location.hash&&o.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"markdown"},t.createElement("blockquote",null,t.createElement("p",null,"\u672c\u7247\u6587\u7ae0\u4e3b\u8981\u901a\u8fc7\u5b9e\u73b0",t.createElement("code",null,"RxJs"),"\u4e00\u4e9b\u7b80\u5355\u64cd\u4f5c\u7b26\uff0c\u6765\u8fdb\u4e00\u6b65\u4e86\u89e3",t.createElement("code",null,"RxJs"))),t.createElement("p",null,t.createElement("strong",null,"\u672c\u7bc7\u6587\u7ae0\u53ef\u4ee5\u5b66\u5230\u4ec0\u4e48?")),t.createElement("ol",null,t.createElement("li",null,"\u6df1\u5165\u4e86\u89e3",t.createElement("code",null,"Observable")),t.createElement("li",null,"js \u57fa\u7840\u77e5\u8bc6(\u7c7b\u3001\u539f\u578b)")),t.createElement("h1",{id:"observable\u9762\u7eb1"},t.createElement(o.AnchorLink,{to:"#observable\u9762\u7eb1","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"Observable\u9762\u7eb1"),t.createElement("p",null,"Observable \u5373RxJs\u4e16\u754c\u4e2d\u7684",t.createElement("strong",null,"\u751f\u4ea7\u8005"),":"),t.createElement("ol",null,t.createElement("li",null,"\u5b83\u5176\u5b9e\u662f\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u5e76\u63a5\u6536\u8ba2\u9605\u8005\u7684\u53c2\u6570\uff0c"),t.createElement("li",null,"\u63d0\u4f9b\u5b9e\u4f8b\u65b9\u6cd5\u8ba9\u5176\u53ef\u4ee5\u8ba2\u9605(forEach)")),t.createElement(l.Z,{code:"function Observable(forEach){\n    this._forEach=forEach\n}",lang:"js"}),t.createElement("p",null,t.createElement("strong",null,"\u26a0\ufe0f"),":\u8fd9\u91cc\u4f7f\u7528forEach\u4ee3\u66ff",t.createElement("code",null,"subscribe"),",\u8be5\u51fd\u6570\u529f\u80fd\u5982\u4e0b:"),t.createElement("ol",null,t.createElement("li",null,"\u63a5\u6536\u53c2\u6570\u5f62\u5f0f\u6709\u4e24\u79cd:",t.createElement("ol",null,t.createElement("li",null,t.createElement("code",null,"onNext"),"\u3001",t.createElement("code",null,"onError"),",",t.createElement("code",null,"onCompleted"),"\u51fd\u6570\uff0c"),t.createElement("li",null,"\u6216\u8005 ",t.createElement("code",null,"{","onNext()","{","}",",onError()","{","}",",onCompleted()","{","}","}")))),t.createElement("li",null,"\u8c03\u7528\u6784\u9020\u51fd\u6570\u5e76\u4f20\u9012\u5982\u4e0b\u683c\u5f0f\u6570\u636e",t.createElement("code",null,"{","onNext()","{","}",",onError()","{","}",",onCompleted()","{","}","}"))),t.createElement(l.Z,{code:"Observable.prototype={\n    forEach(onNext,onError,onCompleted){\n        // call is forEach(()=>{},()=>{},..)\n        if(typeof onNext==='function'){\n            return this._forEach({\n                onNext,\n                onError:onError || function(){},\n                onCompleted:onCompleted|| function(){}\n            })\n        }\n        // call is forEach({onNext:()=>{},onError:()=>{}})\n        else if(typeof onNext==='object'){\n            return this._forEach(onNext)\n        }else{\n            Error('\u65e0\u6548\u53c2\u6570')\n        }\n    }\n}",lang:"js"}),t.createElement("p",null,"\ud83c\udf30: \u4f7f\u7528\u5982\u4e0b"),t.createElement(l.Z,{code:"const observable=new Observable(subscriber=>{\n    subscriber.onNext(1);\n    setTimeout(()=>{\n        subscriber.onCompleted()\n    },1000)\n})\nobservable.forEach({\n    onNext(e){\n        console.log('onNext',e)\n    },\n    onError(){\n\n    },\n    onCompleted(){\n        console.log('completed')\n    }\n})",lang:"js"}),t.createElement("h1",{id:"\u5b9e\u73b0-fromevent\u529f\u80fd"},t.createElement(o.AnchorLink,{to:"#\u5b9e\u73b0-fromevent\u529f\u80fd","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0 fromEvent\u529f\u80fd"),t.createElement("ol",null,t.createElement("li",null,"\u63a5\u6536\u53c2\u6570",t.createElement("code",null,"dom\u8282\u70b9"),"\u4e0e",t.createElement("code",null,"\u4e8b\u4ef6\u540d\u79f0")),t.createElement("li",null,"\u8fd4\u56de ",t.createElement("code",null,"Observable"),"\u5b9e\u4f8b"),t.createElement("li",null,"\u8fd4\u56de\u7684\u5b9e\u4f8b\u63d0\u4f9b",t.createElement("code",null,"dispose"),"\u65b9\u6cd5\u7528\u4e8e\u53d6\u6d88\u76d1\u542c")),t.createElement(l.Z,{code:"Observable.fromEvent=function(dom,eventName){\n    return new Observable(function forEach(observer){\n        const handler=(e)=>observer.onNext(e)\n\n        dom.addEventListener(eventName,handler)\n\n        // subscription\n        return {\n            dispose:()=>{\n                dom.removeEventListener(eventName,handler);\n                observer.onCompleted()\n            }\n        }\n    })\n}",lang:"js"}),t.createElement("h1",{id:"\u5b9e\u73b0\u5176\u5b83\u529f\u80fd\u51fd\u6570"},t.createElement(o.AnchorLink,{to:"#\u5b9e\u73b0\u5176\u5b83\u529f\u80fd\u51fd\u6570","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0\u5176\u5b83\u529f\u80fd\u51fd\u6570"),t.createElement("ol",null,t.createElement("li",null,"\u5904\u7406\u8be5\u529f\u80fd\u5e76\u5411\u4e0b\u4f20\u9012",t.createElement("code",null,"onNext")),t.createElement("li",null,"\u8fd4\u56de",t.createElement("code",null,"Observable"),"\u5bf9\u8c61\u5b9e\u4f8b")),t.createElement("p",null,"**Tip:**\u8fd4\u56de\u5b9e\u4f8b\u7684\u76ee\u524d\u662f\u4e3a\u4e86\u94fe\u5f0f\u8c03\u7528"),t.createElement(l.Z,{code:"Observable.prototype={\n    // ...\n    map(projectionFunction){\n        return new Observable(({onNext,...otherProps})=>{\n           return this.forEach({\n               onNext:(x)=>onNext(projectionFunction(x)),\n               ...otherProps\n           })\n        })\n    }, \n    filter(conditionFunction){\n        \n        return new Observable(observer=>{\n           return this.forEach(\n                (x)=>{\n                    if(conditionFunction(x)){\n                        observer.onNext(x)\n                    }\n                },\n                (e)=>observer.onError(e),\n                ()=>observer.onCompleted()\n            )\n        })\n    },\n    take(num){\n        return new Observable(observer=>{            \n            let counter=0;\n            const subscription= this.forEach(\n                function onNext(v){\n                    observer.onNext(v);\n                    counter++;\n                    if(counter===num){\n                        observer.onCompleted();\n                        subscription.dispose();\n                    }\n                },\n                function onError(e){\n                    observer.onError(e)\n                },\n                function onCompleted(){\n                    observer.onCompleted()\n                }\n            );\n            return subscription;\n        })\n    }\n}",lang:"js"}),t.createElement("h1",{id:"\u5e94\u7528"},t.createElement(o.AnchorLink,{to:"#\u5e94\u7528","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u5e94\u7528"),t.createElement(l.Z,{code:"const btn=document.getElementById('clickBtn');\n\nconst $btn=Observable.\n    fromEvent(btn,'click').\n    filter(e=>e.pageX>20).\n    map(e=>e.pageX+\"px\").\n    take(1)\n\nconst subscription=$btn.forEach({\n    onNext(e){\n        console.log('next',e);\n    },\n    onError(e){\n\n    },\n    onCompleted(){\n        console.log('completed')\n    }\n})",lang:"js"}),t.createElement("p",null,"\ud83e\udd14: \u5728\u4e0a\u9762\u7684",t.createElement("code",null,"Demo"),"\u4e2d\u94fe\u5f0f\u8c03\u7528\u7684\u987a\u5e8f\u5165\u600e\u6837\u7684\u5462\uff1f"),t.createElement("hr",null),t.createElement("p",null,"\u4e0a\u9762\u662f\u672c\u7bc7\u6587\u7ae0\u7684\u5168\u90e8\u5185\u5bb9,\u8fd9\u53ea\u662f\u4e00\u4e2a\u7b80\u5355\u7684",t.createElement("code",null,"demo"),"\u548c\u57fa\u7840\u64cd\u4f5c\u7b26\u7684\u5b9e\u73b0,\u5176\u5b83\u64cd\u4f5c\u7b26\u53ef\u4ee5\u81ea\u884c\u63a2\u7d22\uff5e"),t.createElement(l.Z,{code:"interface Observer {\n    next: (value?: any) => void;\n    error?: (e: any) => void;\n    completed?: () => void;\n}\n\ninterface Unsubscribable {\n    unsubscribe(): void;\n}\n\ntype ISubscribe = (p: Observer) => Unsubscribable\n\nclass Observable {\n    private _subscribe: ISubscribe;\n    constructor(subscribe: ISubscribe) {\n        this._subscribe = subscribe;\n    }\n    public subscribe(observer) {\n        return this._subscribe(observer)\n    }\n    map(projectionFunction) {\n        return new Observable(({ next, ...otherProps }) => {\n            const subscription = this.subscribe({\n                next(x) {\n                    let value;\n                    try {\n                        value = projectionFunction(x);\n                        next(value);\n                    } catch (error) {\n                        otherProps.error(error);\n                        subscription.unsubscribe();\n                    }\n                },\n                ...otherProps\n            });\n            return subscription;\n        })\n    }\n    filter(conditionFunction) {\n        return new Observable(observer => {\n            return this.subscribe({\n                next(x) {\n                    if (conditionFunction(x)) {\n                        observer.next(x)\n                    }\n                },\n                error(e) { observer.error(e) },\n                completed() { observer.completed() }\n            })\n        })\n    }\n    take(num) {\n        return new Observable(observer => {\n            let counter = 0;\n            const subscription = this.subscribe({\n                next(v) {\n                    observer.next(v);\n                    counter++;\n                    if (counter === num) {\n                        observer.completed();\n                        subscription.unsubscribe();\n                    }\n                },\n                error(e) {\n                    observer.error(e)\n                },\n                completed() {\n                    observer.completed()\n                }\n            });\n            return subscription;\n        })\n    }\n    retry(num) {\n        return new Observable(observer => {\n            let currentSub = null;\n            const processRequest = (currentAttempNumber) => {\n                currentSub = this.subscribe({\n                    next(x) {\n                        observer.next(x)\n                    },\n                    completed() {\n                        observer.completed()\n                    },\n                    error(err) {\n                        if (currentAttempNumber === 0) {\n                            observer.error(err);\n                        } else {\n                            processRequest(currentAttempNumber - 1);\n                        }\n                    }\n                })\n            }\n            processRequest(num);\n            return currentSub\n        })\n    }\n    static concat(...observables) {\n        return new Observable(observer => {\n            let myObservables = observables.slice();\n            let currentSub = null;\n\n            let processObservable = () => {\n                if (myObservables.length === 0) {\n                    observer.completed()\n                } else {\n                    let observable = myObservables.shift();\n                    currentSub = observable.subscribe({\n                        next(x) {\n                            observer.next(x)\n                        },\n                        error(err) {\n                            observer.error(err)\n                            currentSub.unsubscribe()\n                        },\n                        completed() {\n                            processObservable()\n                        }\n                    })\n                }\n            }\n            processObservable()\n            return {\n                unsubscribe() {\n                    currentSub && currentSub.unsubscribe()\n                }\n            }\n        })\n    }\n    static fromEvent(dom: HTMLElement, eventName) {\n        return new Observable(observer => {\n            const handle = (e) => observer.next(e);\n            dom.addEventListener(eventName, handle);\n            return {\n                unsubscribe() {\n                    dom.removeEventListener(eventName, handle);\n                    observer.completed()\n                }\n            }\n        })\n    }\n    static timeout(time) {\n        return new Observable(function subscribe(observer) {\n            const handle = setTimeout(() => {\n                observer.next();\n                observer.completed()\n            }, time);\n            return {\n                unsubscribe() {\n                    clearTimeout(handle)\n                }\n            }\n        })\n    }\n}\n\n// *****************\n// \u7528\u4e8e\u6d4b\u8bd5\n// *****************\n\nvar btn = document.getElementById('clickBtn');\n\nvar ob = Observable.\n    fromEvent(btn, 'click').\n    filter(e => e.pageX > 20).\n    map(e => e.pageX + \"px\").\n    take(1)\n// var ob=Observable.timeout(500);\n\n\nconst subscription = ob.subscribe({\n    next() {\n        console.log('next');\n        subscription.unsubscribe();\n    },\n    completed() {\n        console.log('completed')\n    }\n})",lang:"js"}))))}}]);
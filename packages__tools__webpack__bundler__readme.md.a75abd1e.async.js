(self["webpackChunkFE_note"]=self["webpackChunkFE_note"]||[]).push([[6447],{1422:e=>{"use strict";e.exports={}},3859:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>t});const t={}},3031:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>c});var t=r(7294),l=r(6584),a=r(2196);r(3859);const c=e=>(t.useEffect((()=>{null!==e&&void 0!==e&&e.location.hash&&l.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"markdown"},t.createElement("h1",{id:"\u7b80\u6613\u6253\u5305\u5de5\u5177\u7f16\u5199"},t.createElement(l.AnchorLink,{to:"#\u7b80\u6613\u6253\u5305\u5de5\u5177\u7f16\u5199","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u7b80\u6613\u6253\u5305\u5de5\u5177\u7f16\u5199"),t.createElement("blockquote",null,t.createElement("p",null,"npm install @babel/parser --save-dev  //babel\u89e3\u6790\u5668,\u53ef\u4ee5\u5c06\u4ee3\u7801\u8f6c\u6362\u4e3aAST\u5bf9\u8c61")),t.createElement("blockquote",null,t.createElement("p",null,"npm install @babel/traverse --save  //\u904d\u5386AST\u8282\u70b9\uff0c\u6709\u52a9\u4e8e\u6211\u4eec\u67e5\u627e")),t.createElement("blockquote",null,t.createElement("p",null,"npm install @babel/core --save  //babel \u6838\u5fc3\u6a21\u5757")),t.createElement("blockquote",null,t.createElement("p",null,"npm install @babel/preset-env --save")),t.createElement("p",null,t.createElement(l.Link,{to:"./bundle.js"},"source")),t.createElement("h1",{id:"\u62d3\u5c55"},t.createElement(l.AnchorLink,{to:"#\u62d3\u5c55","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u62d3\u5c55"),t.createElement("p",null,"\u9ad8\u4eae\u663e\u793a\u4ee3\u7801 \u5de5\u5177"),t.createElement("blockquote",null,t.createElement("p",null,"npm install cli-highlight -g")),t.createElement("p",null,"\u4f7f\u7528"),t.createElement("blockquote",null,t.createElement("p",null,"node  xx.js | hightlight")),t.createElement("h2",{id:"\u6e90\u7801"},t.createElement(l.AnchorLink,{to:"#\u6e90\u7801","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u6e90\u7801"),t.createElement(a.Z,{code:"const fs = require('fs');\r\nconst path = require('path');\r\nconst parser = require('@babel/parser');\r\nconst babel = require('@babel/core');\r\nconst traverse = require('@babel/traverse').default;\r\n\r\n/**\r\n * @description \u5206\u6790\u5f15\u5165\u6a21\u5757\u6587\u4ef6\r\n * @param {string} filename \r\n */\r\nconst moduleAnalyser = (filename) => {\r\n  const content = fs.readFileSync(filename, 'utf-8');\r\n  //\u5c06\u4ee3\u7801\u5206\u6790\u751f\u6210\u62bd\u8c61\u8bed\u6cd5\u6811\r\n  const ast = parser.parse(content, {\r\n    sourceType: 'module',\r\n  });\r\n  //\u5b58\u50a8\u6587\u4ef6\u7684\u4f9d\u8d56\u5173\u7cfb \u76f8\u5bf9\u8def\u5f84 \u548c\u7edd\u5bf9\u8def\u5f84\r\n  const dependencies = {};\r\n  traverse(ast, {\r\n    ImportDeclaration({ node }) {\r\n      const dirname = path.dirname(filename);\r\n      const newFile = './' + path.join(dirname, node.source.value);\r\n      dependencies[node.source.value] = newFile;\r\n    }\r\n  });\r\n  const { code } = babel.transformFromAst(ast, null, {\r\n    presets: ['@babel/preset-env']\r\n  });\r\n  // console.log(code);\r\n  return {\r\n    filename,\r\n    dependencies,\r\n    code,\r\n  }\r\n  // console.log(ast.program.body);\r\n}\r\n/**\r\n * \u5206\u6790\u6240\u6709\u6a21\u5757\u4f9d\u8d56\u5173\u7cfb\r\n * @param {string} entry \r\n * @return {Object}\r\n */\r\nconst makeDependenciesGraph = (entry) => {\r\n  const entryModule = moduleAnalyser(entry);\r\n  const graphArry = [entryModule];\r\n  for (let i = 0; i < graphArry.length; i++) {\r\n    const item = graphArry[i];\r\n    const { dependencies } = item;\r\n    if (dependencies) {\r\n      for (let j in dependencies) {\r\n        graphArry.push(moduleAnalyser(dependencies[j]))\r\n      }\r\n    }\r\n  }\r\n  const graph = {}\r\n  graphArry.forEach(({ filename, dependencies, code }) => {\r\n    graph[filename] = {\r\n      dependencies,\r\n      code\r\n    }\r\n  });\r\n  return graph;\r\n}\r\n//\u8f6c\u6362\u751f\u6210\u4ee3\u7801\r\nconst generateCode = (entry) => {\r\n  const graph = JSON.stringify(makeDependenciesGraph(entry));\r\n  return `\r\n  (function(graph){\r\n    function require(module) { \r\n      function localRequire(relativePath) {\r\n        return require(graph[module].dependencies[relativePath]);\r\n      }\r\n      var exports = {};\r\n      (function(require, exports, code){\r\n        eval(code)\r\n      })(localRequire, exports, graph[module].code);\r\n      return exports;\r\n    };\r\n    require('${entry}')\r\n  })(${graph});\r\n`;\r\n}\r\nconst code = generateCode('./src/index.js');\r\nconsole.log(code);",lang:"js"}))))}}]);
(self["webpackChunkFE_note"]=self["webpackChunkFE_note"]||[]).push([[7836],{1422:e=>{"use strict";e.exports={}},3859:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>t});const t={}},6682:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>o});var t=s(7294),r=s(6584),i=s(2196);s(3859);const o=e=>(t.useEffect((()=>{null!==e&&void 0!==e&&e.location.hash&&r.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),t.createElement(t.Fragment,null,t.createElement("div",{className:"markdown"},t.createElement("h1",{id:"redis-\u4ecb\u7ecd"},t.createElement(r.AnchorLink,{to:"#redis-\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"redis \u4ecb\u7ecd"),t.createElement("ul",null,t.createElement("li",null,"redis \u53ef\u7528\u4f5c\u6570\u636e\u5e93\u3001\u9ad8\u901f\u7f13\u5b58\u548c\u6d88\u606f\u961f\u5217\u4ee3\u7406,\u5e76\u975e\u5e38\u9002\u5408\u5904\u7406\u77ed\u65f6\u95f4\u5185\u88ab\u9ad8\u9891\u8bbf\u95ee\u4f46\u53c8\u4e0d\u9700\u8981\u957f\u671f\u8bbf\u95ee\u7684\u7b80\u5355\u6570\u636e\u5b58\u50a8\u3002"),t.createElement("li",null,"redis \u662f\u65e2\u53ef\u4ee5\u57fa\u4e8e\u5185\u5b58\u4e5f\u53ef\u4ee5\u6301\u4e45\u5316\u7684\u65e5\u5fd7\u578b Key-Value \u6570\u636e\u5e93,\u5e76\u652f\u6301\u591a\u79cd\u8bed\u8a00\u7684 API,\u5b83\u901a\u5e38\u88ab\u79f0\u4e3a\u6570\u636e\u7ed3\u6784\u670d\u52a1\u5668\u3002")),t.createElement("h2",{id:"\u5b89\u88c5-redis\uff08windows\uff09"},t.createElement(r.AnchorLink,{to:"#\u5b89\u88c5-redis\uff08windows\uff09","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5 redis\uff08windows\uff09"),t.createElement("p",null,t.createElement(r.Link,{to:"https://github.com/MicrosoftArchive/redis/releases"},"gitHub")),t.createElement("p",null,"\u5177\u4f53\u6b65\u9aa4\u53c2\u8003\u4e0b\u9762\u94fe\u63a5: ",t.createElement(r.Link,{to:"https://www.cnblogs.com/cang12138/p/8880776.html"},"\u53c2\u8003\u539f\u6587")),t.createElement("p",null,t.createElement("strong",null,"\u5e38\u7528\u547d\u4ee4:")," \u5378\u8f7d\u670d\u52a1\uff1aredis-server --service-uninstall \u5f00\u542f\u670d\u52a1\uff1aredis-server --service-start \u505c\u6b62\u670d\u52a1\uff1aredis-server --service-stop \u542f\u52a8 Redis \u547d\u4ee4\u884c\u5de5\u5177: redis-cli"),t.createElement("p",null,t.createElement("strong",null,"\u8fde\u63a5\u8fdc\u7a0b Redis \u670d\u52a1")),t.createElement("blockquote",null,t.createElement("p",null,"redis-cli -h host -p port -a password host \u662f\u4e3b\u673a\u540d,port \u662f\u7aef\u53e3\u53f7,password \u662f\u8fdc\u7a0b\u670d\u52a1\u5668\u5bc6\u7801")),t.createElement("h2",{id:"node-\u4e2d\u4f7f\u7528"},t.createElement(r.AnchorLink,{to:"#node-\u4e2d\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"node \u4e2d\u4f7f\u7528"),t.createElement("blockquote",null,t.createElement("p",null,"npm i redis --save")),t.createElement(i.Z,{code:"const redis = require('redis');\n//\u8fde\u63a5\u672c\u5730Redis\u670d\u52a1\nconst client = redis.createClient(6379, '127.0.0.1');\n//\u64cd\u4f5credis\n//1. \u5b57\u7b26\u4e32\nclient.set('name', 'cc', redis.print); //redis.print \u6253\u5370\u8bbe\u7f6e\u7684\u6570\u636e\u7ed3\u679c\nclient.get('name', (err, value) => {\n  if (err) throw err;\n  console.log('Name:', value);\n});\n//2.\u54c8\u5e0c\u503c(Hash)\nclient.hmset('person', {\n  //\u5b58\u50a8\u4e00\u4e2a\u5bf9\u8c61\n  name: 'cc',\n  age: 24,\n});\nclient.hgetall('person', (err, obj) => {\n  if (err) throw err;\n  console.log('\u901a\u8fc7Hash\u5b58\u50a8:', obj);\n});\n\n//3. \u96c6\u5408(Set)\nclient.sadd('address', '\u4e0a\u6d77', redis.print);\nclient.sadd('address', '\u5317\u4eac', redis.print);\nclient.sadd('address', '\u897f\u5b89', redis.print);\nclient.sadd('address', '\u5e7f\u5dde', redis.print);\n//\u83b7\u53d6\u96c6\u5408\u7684\u503c\nclient.smembers('address', (err, members) => {\n  if (err) throw err;\n  console.log('\u83b7\u53d6\u96c6\u5408\u7684\u503c:', members);\n});\n//4. List\n//lpush\u5411\u5217\u8868\u4e2d\u6dfb\u52a0\u503c\n// lrange \u83b7\u53d6\u53c2\u6570 start-end\u8303\u56f4\u5185\u7684\u5217\u8868\u5143\u7d20\n\nclient.lpush('animal', 'dog', redis.print);\nclient.lpush('animal', 'cat', redis.print);\nclient.lpush('animal', 'pig', redis.print);\nclient.lrange('animal', 0, 1, (err, items) => {\n  if (err) throw err;\n  items.forEach((item, i) => {\n    console.log(`\u83b7\u53d6List\u5185\u5bb9\u3001i-item:${i}-${item}`);\n  });\n});\n\nclient.on('error', (err) => {\n  console.log('redis clinet Error', err);\n});",lang:"javascript"}),t.createElement("h1",{id:"session"},t.createElement(r.AnchorLink,{to:"#session","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"Session"),t.createElement("p",null,"\u5b83\u662f\u7528\u4e8e\u63a7\u5236\u7f51\u7edc\u4f1a\u8bdd\u7684,\u5982\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\u3001\u8d2d\u7269\u8f66\u4e2d\u5546\u54c1\u7b49\u3002Session \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef,\u5728\u670d\u52a1\u7aef\u6709\u5f88\u591a\u5b58\u50a8\u65b9\u5f0f,\u5b83\u53ef\u4ee5\u4fdd\u5b58\u5728\u5185\u5b58\u3001(Redis\u3001MongoDB)\u7b49\u6570\u636e\u5e93\u4e2d\u3001\u6587\u4ef6\u4e2d\u3002\u5728\u5ba2\u6237\u7aef\u901a\u8fc7 Cookie \u6765\u4fdd\u5b58 Session \u7684\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6,\u4f7f\u7528 Cookie \u7684\u539f\u56e0\u662f\u6bcf\u4e2a HTTP \u8bf7\u6c42\u5934\u90fd\u53ef\u4ee5\u5e26\u4e0a Cookie \u4fe1\u606f,\u5e76\u53ef\u4ee5 ",t.createElement("strong",null,"\u8bbe\u7f6e HtppOnly=true"),"\u9632\u6b62\u5ba2\u6237\u7aef\u7be1\u6539 Cookie."),t.createElement("h2",{id:"node-\u4e2d\u5e94\u7528"},t.createElement(r.AnchorLink,{to:"#node-\u4e2d\u5e94\u7528","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"node \u4e2d\u5e94\u7528"),t.createElement("blockquote",null,t.createElement("p",null,"npm install koa-session")),t.createElement(i.Z,{code:"const Koa = require('koa');\nconst app = new Koa();\nconst session = require('koa-session');\nconst secretSessionKey = 'secert_key';\napp.keys = [secretSessionKey]; //\u8bbe\u7f6e\u7b7e\u540dCookie\u79d8\u94a5\nconst CONFIG = {\n  key: 'myAppSessKey', //Cookie\u4e2d\u7684key\n  maxAge: '3600000', //\u5931\u6548\u65f6\u95f4 \u5355\u4f4dms\n  overwrite: true, //\u662f\u5426\u53ef\u4ee5\u8986\u76d6\n  httpOnly: true, //\u662f\u5426\u7981\u6b62\u5ba2\u6237\u7aef\u7be1\u6539\n  signed: true, //\u7b7e\u540d\u662f\u5426\u5f00\u542f\n};\napp.use(session(CONFIG, app)); //\u52a0\u8f7dsession \u4e2d\u95f4\u4ef6\napp.use(async (ctx) => {\n  if (ctx.path === '/favicon.ico') return;\n  console.log(ctx.session, 'views');\n  let n = ctx.session.views || 0;\n  ctx.session.views = ++n;\n  ctx.body = `${n} \u7f51\u7ad9\u52a0\u8f7d\u6b21\u6570 views`;\n});\napp.listen(3000, () => {\n  console.log('app listen at port 3000');\n});",lang:"javascript"}),t.createElement("h2",{id:"redis-\u5b58\u50a8-session"},t.createElement(r.AnchorLink,{to:"#redis-\u5b58\u50a8-session","aria-hidden":"true",tabIndex:-1},t.createElement("span",{className:"icon icon-link"})),"redis \u5b58\u50a8 Session"),t.createElement(i.Z,{code:"const Koa = require('koa');\nconst app = new Koa();\nconst session = require('koa-session');\nconst redis = require('redis');\nconst client = redis.createClient(6379, '127.0.0.1'); //\u8fde\u63a5\u672c\u673aRedis\u670d\u52a1\nconst secretSessionKeys = 'secret_session';\nconst { promisify } = require('util');\nconst hgetllAsync = promisify(client.hgetall).bind(client);\n\napp.keys = [secretSessionKeys];\nconst store = {\n  get: async (key, maxAge) => {\n    const result = await hgetllAsync(key);\n  },\n  set: (key, sess, maxAge) => {\n    //\u5b58\u50a8Session\n    client.hmset(key, sess);\n  },\n  destroy: (key) => {\n    //\u9500\u6bc1\n    client.hdel(key);\n  },\n};\nconst CONFIG = {\n  key: 'session_redis',\n  maxAge: 3600000,\n  overwrite: true,\n  httpOnly: true,\n  signed: true,\n  store,\n};\napp.use(session(CONFIG, app)); //\u4f7f\u7528session\u4e2d\u95f4\u4ef6\napp.use((ctx) => {\n  if (ctx.path === '/favicon.ico') return;\n  let n = ctx.session.views || 0;\n  ctx.session.views = ++n;\n  ctx.body = `${n} views`;\n});\napp.listen(3000, () => {\n  console.log('app listen at 3000');\n});",lang:"javascript"}))))}}]);
(self["webpackChunkFE_note"]=self["webpackChunkFE_note"]||[]).push([[5521],{1422:e=>{"use strict";e.exports={}},3859:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>r});const r={}},4610:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});var r=t(7294),o=t(6584),s=t(2196);t(3859);const l=e=>(r.useEffect((()=>{null!==e&&void 0!==e&&e.location.hash&&o.AnchorLink.scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.createElement(r.Fragment,null,r.createElement("div",{className:"markdown"},r.createElement("blockquote",null,r.createElement("p",null,"\u4f7f\u7528TypeScript+Express+NodeJS+MongoDB \u5f00\u53d1 Web APIs,\u5982\u6709\u9519\u8bef\u53ef\u4ee5\u51fb\u63d0issue \ud83d\udcaa,\u5982\u679c\u89c9\u5f97ok,\u8bf7\u70b9\u4e2astar \ud83d\ude4f, ",r.createElement("code",null,"\u9001\u4eba\u73ab\u7470\u3001\u624b\u6709\u4f59\u9999"))),r.createElement("h1",{id:"\u76ee\u5f55"},r.createElement(o.AnchorLink,{to:"#\u76ee\u5f55","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u76ee\u5f55"),r.createElement("ul",null,r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u76ee\u5f55")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"},"\u642d\u5efa\u5f00\u53d1\u73af\u5883")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#hello-express"},"hello express")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E6%9E%84%E5%BB%BA%E8%B7%AF%E7%94%B1"},"\u6784\u5efa\u8def\u7531")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E5%BC%95%E5%85%A5mongodb"},"\u5f15\u5165MongoDB")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#nodejs%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"},"nodeJs\u9519\u8bef\u5904\u7406")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#auth"},"auth"),r.createElement("ul",null,r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E7%99%BB%E5%BD%95%E4%B8%8E%E6%B3%A8%E5%86%8C%E6%A8%A1%E5%9D%97"},"\u767b\u5f55\u4e0e\u6ce8\u518c\u6a21\u5757")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E4%BD%BF%E7%94%A8jwt%E4%BB%A4%E7%89%8C%E8%BF%9B%E8%A1%8C%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"},"\u4f7f\u7528JWT\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1")))),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E6%80%BB%E7%BB%93"},"\u603b\u7ed3")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E5%8F%82%E8%80%83%E5%9C%B0%E5%9D%80"},"\u53c2\u8003\u5730\u5740")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E5%B7%A5%E5%85%B7"},"\u5de5\u5177")),r.createElement("li",null,r.createElement(o.AnchorLink,{to:"#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"},"\u53c2\u8003\u6587\u6863"))),r.createElement("h1",{id:"\u642d\u5efa\u5f00\u53d1\u73af\u5883"},r.createElement(o.AnchorLink,{to:"#\u642d\u5efa\u5f00\u53d1\u73af\u5883","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u642d\u5efa\u5f00\u53d1\u73af\u5883"),r.createElement("blockquote",null,r.createElement("p",null,"npm init -y npm i express @types/node @types/express body-parser mongoose cors @types/cors npm i typescript ts-node-dev morgan @types/morgan rimraf -D")),r.createElement("p",null,r.createElement("code",null,"\u521b\u5efa ts \u914d\u7f6e")),r.createElement("blockquote",null,r.createElement("p",null,"npx typescript --init")),r.createElement("p",null,"\u4fee\u6539",r.createElement("code",null,"tsconfig.json"),"\u914d\u7f6e"),r.createElement(s.Z,{code:'{\n  "compilerOptions": {\n    "target": "es6",\n    "module": "commonjs",\n    "sourceMap": true,\n    "outDir": "./dist",\n    "removeComments": true,\n    /* Strict Type-Checking Options */\n    "strict": true,\n    "noImplicitAny": false,\n    "strictNullChecks": true,\n    "alwaysStrict": true,\n    /* Module Resolution Options */\n    "moduleResolution": "node",\n    "baseUrl": "./src",\n    "allowSyntheticDefaultImports": true, \n    "esModuleInterop": true,  \n  },\n  "include": [\n    "./src/**/*"\n  ]\n}                     /* Redirect output structure to the directory. */',lang:"json"}),r.createElement("p",null,r.createElement("code",null,"\u914d\u7f6e\u811a\u672c\u547d\u4ee4")),r.createElement(s.Z,{code:'"scripts": {\n    "build": "tsc",\n    "dev": "ts-node-dev \u2014 respawn \u2014 transpileOnly ./src/server.ts",\n     "restart": "rimraf dist && npm run build && npm start",\n    "start":"node ./dist/server.js",\n    "prod":"npm run build && npm run start"\n  },',lang:"js"}),r.createElement("h1",{id:"hello-express"},r.createElement(o.AnchorLink,{to:"#hello-express","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"hello express"),r.createElement("p",null,r.createElement("code",null,"src/server.ts")),r.createElement(s.Z,{code:"import app from './app'\nconst PORT=3000;\n\napp.listen(PORT,()=>{\n    console.log(`Express server listening on port ${PORT}`);\n})",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"app.ts")),r.createElement(s.Z,{code:"import express from 'express' \nimport {json,urlencoded} from 'body-parser'\nimport cors from 'cors'\nimport morgan from 'morgan'\n\nclass App{\n    public app:express.Application;\n    private router=new Routes();\n    constructor(){\n        this.app=express();\n        this.config()\n        // \u5f15\u5165\u8def\u7531\n        this.app.get('/',(req,res)=>{\n          res.send({message:'hello express'})\n        })\n    }\n    private config(){\n        //\u5f00\u542f cors\n        this.app.use(cors())\n        //\u652f\u6301  application/json\u7c7b\u578b \u53d1\u9001\u6570\u636e\n        this.app.use(json());\n        //\u652f\u6301 application/x-www-form-urlencoded \u53d1\u9001\u6570\u636e\n        this.app.use(urlencoded({extended:false}))\n        //\u65e5\u5fd7\u4e2d\u95f4\u4ef6\n        this.app.use(morgan('dev'))\n    }\n\n}\nexport default new App().app",lang:"js"}),r.createElement("ul",null,r.createElement("li",null,"body-parser:\u6b63\u6587\u89e3\u6790\u5668\u4f7f\u6211\u4eec\u53ef\u4ee5\u63a5\u6536\u5e26\u6709\u4e0d\u540c\u683c\u5f0f\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u4f8b\u5982json\u6216x-www-form-urlencoded\u3002"),r.createElement("li",null,"CORS (Cross-Origin Resource Sharing):\u4f7f\u7528\u9644\u52a0\u7684HTTP\u6807\u5934\uff0c\u8fd9\u4e9b\u6807\u5934\u4f7f\u6211\u4eec\u7684\u6d4f\u89c8\u5668\u77e5\u9053\u5fc5\u987b\u5141\u8bb8\u5728\u4e00\u4e2a\u57df\u4e2d\u8fd0\u884c\u7684Web\u5e94\u7528\u7a0b\u5e8f\u4ece\u5176\u4ed6\u6765\u6e90\u7684\u670d\u52a1\u5668\u8bbf\u95ee\u8d44\u6e90\u3002")),r.createElement("p",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u2b06 back to top")),r.createElement("h1",{id:"\u6784\u5efa\u8def\u7531"},r.createElement(o.AnchorLink,{to:"#\u6784\u5efa\u8def\u7531","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa\u8def\u7531"),r.createElement("p",null,r.createElement("code",null,"RESTful")),r.createElement("ul",null,r.createElement("li",null,"GET:\u7528\u6765\u83b7\u53d6\u8d44\u6e90"),r.createElement("li",null,"POST:\u7528\u6765\u65b0\u5efa\u8d44\u6e90(\u4e5f\u53ef\u4ee5\u7528\u4e8e\u66f4\u65b0\u8d44\u6e90)"),r.createElement("li",null,"PUT:\u7528\u6765\u66f4\u65b0\u8d44\u6e90"),r.createElement("li",null,"DELETE:\u7528\u6765\u5220\u9664\u8d44\u6e90")),r.createElement("p",null,r.createElement("code",null,"\u76ee\u5f55\u7ed3\u6784")),r.createElement(s.Z,{code:"\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 src\n\u2502\xa0\xa0 \u251c\u2500\u2500 app.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 controllers\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 userController.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 routes\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 index.ts\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 user.ts\n\u2502\xa0\xa0 \u2514\u2500\u2500 server.ts\n\u2514\u2500\u2500 tsconfig.json",lang:"unknown"}),r.createElement("p",null,r.createElement("code",null,"routers/index.ts")),r.createElement(s.Z,{code:"import { Router} from \"express\";\nimport user from './user'\n\nconst routes = Router();\n\nroutes.use('/user',user)\n\nexport default routes",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"routes/user.ts")),r.createElement(s.Z,{code:"import {Router} from 'express'\nimport UserController from '../controllers/userController'\n\nconst router=Router();\n\n/**\n * @route /user\n * get: \u83b7\u53d6\u6240\u6709\u7528\u6237\n * post\uff1a\u521b\u5efa\u7528\u6237\n */  \nrouter\n    .route('/')\n    .get(UserController.listAll)\n    .post(UserController.newUser)\n\n\n/**\n * @route /user/:id\n * get:\u901a\u8fc7id \u83b7\u53d6\u7528\u6237\n * put:\u7f16\u8f91\u7528\u6237\n * delete:\u5220\u9664\u7528\u6237\n */\nrouter\n    .route('/:id')\n    .get(UserController.getOneById)\n    .put(UserController.editUser)\n    .delete(UserController.delUser)\n\n\nexport default router",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"controllers/userController.ts")),r.createElement(s.Z,{code:"import { Request, Response } from \"express\";\nclass UserController{\n    static listAll=async (req:Request,res:Response)=>{\n        console.log('list ALl');\n    }\n    static getOneById=async(req:Request,res:Response)=>{\n        console.log('get one by id');\n    }\n    static newUser=async (req:Request,res:Response)=>{\n        console.log('create user');\n    }\n   static editUser=async (req:Request,res:Response)=>{\n        console.log('edit user');\n    }\n    static delUser=async (req:Request,res:Response)=>{\n        console.log('del user');\n    }\n}\nexport default UserController",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"app.ts"),"\u4e2d\u5f15\u5165\u8def\u7531"),r.createElement(s.Z,{code:"import routes from './routes'\n\n//...\nconstructor(){\n      this.app=express();\n      this.config()\n      // \u5f15\u5165\u8def\u7531\n      this.app.use(routes)\n  }\n//...",lang:"js"}),r.createElement("p",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u2b06 back to top")),r.createElement("h1",{id:"\u5f15\u5165mongodb"},r.createElement(o.AnchorLink,{to:"#\u5f15\u5165mongodb","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u5f15\u5165MongoDB"),r.createElement("p",null,r.createElement(o.Link,{to:"./mongoDB"},"MongoDB\u5b89\u88c5\u4e0e\u5165\u95e8")),r.createElement("p",null,r.createElement("code",null,"\u76ee\u5f55\u7ed3\u6784")),r.createElement(s.Z,{code:"\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 src\n\u2502\xa0\xa0 \u251c\u2500\u2500 config\n\u2502\xa0\xa0 \u2502\xa0\xa0\u2514\u2500\u2500 index.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 controllers\n\u2502\xa0\xa0 \u2502\xa0\xa0\u2514\u2500\u2500 userControllers.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 models\n\u2502\xa0\xa0 \u2502\xa0\xa0\u2514\u2500\u2500 user.model.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 routes\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 index.ts\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 user.ts\n\u2502\xa0\xa0 \u2514\u2500\u2500 server.ts\n\u2502\xa0\xa0 \u251c\u2500\u2500 app.ts\n\u2514\u2500\u2500 tsconfig.json",lang:"unknown"}),r.createElement("p",null,r.createElement("strong",null,"\u5f15\u5165Mongoose")," \u27a1\ufe0f ",r.createElement("code",null,"app.ts")),r.createElement(s.Z,{code:"class App{\n\nconstructor(){\n   //... \u7701\u7565\u5176\u5b83\n    this.setMongoConfig()\n}\n// ...\n\nprivate setMongoConfig(){\n    mongoose.Promise = global.Promise;\n    mongoose.connect(DB_URL, {\n        useNewUrlParser: true\n        });\n    }\n}",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"\u914d\u7f6e\u6587\u4ef6")," \u27a1\ufe0f ",r.createElement("code",null,"config/index.ts")),r.createElement(s.Z,{code:"export const DB_URL='mongodb://localhost:27017/express-api';\nexport const PORT=3000;",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"\u6dfb\u52a0Models")," \u27a1\ufe0f ",r.createElement("code",null,"user.model.ts")),r.createElement(s.Z,{code:"import * as mongoose from 'mongoose'\n\nconst Schema=mongoose.Schema;\n\nconst userSchema = new Schema({\n    firstName: {\n        type: String,\n        required: 'Enter a first name'\n    },\n    lastName: {\n        type: String,\n        required: 'Enter a last name'\n    },\n    email: {\n        type: String\n    },\n    status:{\n        type:String,\n        required:true,\n        enum:['active','complete','pastdue'],\n        default:'active'\n    },\n    company: {\n        type: String\n    },\n    phone: {\n        type: Number\n    },\n    created_date: {\n        type: Date,\n        default: Date.now\n    }\n});\n\nconst User=mongoose.model('user',userSchema)\n\nexport default User",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"\u5904\u7406\u4e1a\u52a1\u903b\u8f91(Controllers)")," \u27a1\ufe0f ",r.createElement("code",null,"controllers/userController.ts")),r.createElement("ul",null,r.createElement("li",null,"\u589e\u52a0(C): model.create()\u3001new model()"),r.createElement("li",null,"\u67e5\u8be2(R): model.find()\u3001model.findOne()\u3001model.findById()"),r.createElement("li",null,"\u4fee\u6539(U):model.update()\u3001model.findByIdAndUpdate()\u3001model.findOneUpdate()"),r.createElement("li",null,"\u5220\u9664(D):model.remove()\u3001model.findByIdAndRemove()\u3001model.findOneRemove()")),r.createElement(s.Z,{code:"import { Request, Response } from \"express\";\nimport User from '../models/user.model'\n\nclass UserController{\n    static listAll=async (req:Request,res:Response)=>{\n        console.log('list ALl');\n        User.find({},(err,allInfo)=>{\n            if(err){\n                res.send(err)\n            }\n                res.send(allInfo)\n        })\n    }\n    static getOneById=async(req:Request,res:Response)=>{\n        console.log('get one by id');\n        User.findById(req.params.id,(err,userInfo)=>{\n            if(err){\n                res.send(err)\n            }\n            res.send(userInfo)\n        })\n    }\n    static newUser=async (req:Request,res:Response)=>{\n        console.log('create user');\n        let newUser=new User(req.body);\n        newUser.save((err,info)=>{\n            if(err){\n                res.send(err)\n            }\n            res.send(info)\n        })\n\n    }\n   static editUser=async (req:Request,res:Response)=>{\n        console.log('edit user');\n        User.findOneAndUpdate({_id:req.params.id},req.body,(err,info)=>{\n            if(err){\n                res.send(err)\n            }\n            res.send(info)\n        })\n\n    }\n    static delUser=async (req:Request,res:Response)=>{\n        console.log('del user');\n        User.remove({_id:req.params.id},(err)=>{\n            if(err){\n                res.send(err)\n            }\n            res.send({message:'Successfully deleted user!'})\n        })\n    }\n}\nexport default UserController",lang:"js"}),r.createElement("p",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u2b06 back to top")),r.createElement("h1",{id:"nodejs\u9519\u8bef\u5904\u7406"},r.createElement(o.AnchorLink,{to:"#nodejs\u9519\u8bef\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"nodeJs\u9519\u8bef\u5904\u7406"),r.createElement("p",null,"\u901a\u8fc7\u4e0a\u9762\u7684\u5b66\u4e60,\u5b58\u5728\u4e00\u4e2a\u5f88\u5927\u95ee\u9898,\u5c31\u662f\u6211\u4eec\u628a\u64cd\u4f5c\u6570\u636e\u5e93\u7684\u9519\u8bef\u629b\u7ed9\u4e86",r.createElement("code",null,"client"),"\u8fd9\u79cd\u5b9e\u8df5\u662f\u975e\u5e38\u7cdf\u7cd5\u7684,\u73b0\u5728\u6211\u4eec\u5c01\u88c5\u4e00\u4e2a\u9519\u8bef\u5904\u7406\u7684\u4e2d\u95f4\u4ef6\u3002"),r.createElement("blockquote",null,r.createElement("p",null,"\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u5c06\u7528\u4e8e\u5f15\u53d1\u9519\u8bef\u7684\u7c7b\u3002")),r.createElement("p",null,r.createElement("code",null,"src/exceptions/HttpException.ts")),r.createElement(s.Z,{code:"class HttpException extends Error{\n    constructor(public status:number,public message:string){\n        super(message);\n        this.status=status;\n        this.message=message\n    }\n}\nexport default HttpException",lang:"js"}),r.createElement("blockquote",null,r.createElement("p",null,"\u5982\u679c\u60a8\u60f3\u4e86\u89e3\u6709\u5173Error\u5bf9\u8c61\u548c\u4e00\u822c\u9519\u8bef\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u5c1d\u8bd5\u4f7f\u7528",r.createElement(o.Link,{to:"https://wanago.io/2018/11/12/handling-errors-in-javascript-with-try-catch-and-finally/"},"try\u2026catch"),"\u68c0\u67e5  JavaScript\u5904\u7406\u9519\u8bef\uff0c\u6700\u540e")),r.createElement("blockquote",null,r.createElement("p",null,"\u63a5\u4e0b\u6765\uff0c\u4e66\u5199\u9519\u8bef\u4e2d\u95f4\u4ef6")),r.createElement("p",null,r.createElement("code",null,"middleware/error.middleware.ts")),r.createElement(s.Z,{code:"import {Request,Response,NextFunction} from 'express'\nimport HttpException from '../expceptions/httpException'\nfunction errorMiddleware(error:HttpException,request:Request,response:Response,next:NextFunction){\n    const status=error.status||500;\n    const message=error.message||'Something went wrong';\n    response\n        .status(status)\n        .send({\n            status,\n            message\n        })\n}\nexport default errorMiddleware",lang:"js"}),r.createElement("blockquote",null,r.createElement("p",null,"\u5f15\u5165\u4e2d\u95f4\u4ef6")),r.createElement("p",null,r.createElement("code",null,"app.ts")),r.createElement(s.Z,{code:"import express from 'express' \nimport {json,urlencoded} from 'body-parser'\nimport cors from 'cors'\nimport morgan from 'morgan'\nimport routes from './routes'\nimport mongoose from 'mongoose';\nimport errorMiddleware from './middleware/error.middleware'\nimport {DB_URL} from './config'\n\nclass App{\n    public app:express.Application;\n    constructor(){\n        this.app=express();\n        this.config()\n        this.setMongoConfig()\n        \n        // \u5f15\u5165\u8def\u7531\n        this.app.use(routes)\n\n        //\u9519\u8bef\u5904\u7406\n        this.initializeErrorHandling();\n    }\n\n    private config(){\n        //\u5f00\u542f cors\n        this.app.use(cors())\n        //\u652f\u6301  application/json\u7c7b\u578b \u53d1\u9001\u6570\u636e\n        this.app.use(json());\n        //\u652f\u6301 application/x-www-form-urlencoded \u53d1\u9001\u6570\u636e\n        this.app.use(urlencoded({extended:false}))\n        //\u65e5\u5fd7\u4e2d\u95f4\u4ef6\n        this.app.use(morgan('dev'))\n    }\n    \n    private initializeErrorHandling(){\n        this.app.use(errorMiddleware)\n    }\n\n    private setMongoConfig(){\n        mongoose.Promise = global.Promise;\n        mongoose.connect(DB_URL, {\n            useNewUrlParser: true\n          });\n    }\n\n}\nexport default new App().app",lang:"js"}),r.createElement("blockquote",null,r.createElement("p",null,"\u5e94\u7528")),r.createElement("p",null,r.createElement("code",null,"controllers/userController.ts")),r.createElement(s.Z,{code:"import HttpException from '../expceptions/httpException'\n\nclass UserController{\n    static getOneById=async(req:Request,res:Response,next:NextFunction)=>{\n        const id=req.params.id;\n        User.findById(id,(err,userInfo)=>{\n            if(err){\n                next(new HttpException(404,`id:${id},not found`))\n            }else{\n                res.send(userInfo)\n\n            }            \n        })\n    }\n}",lang:"js"}),r.createElement("blockquote",null,r.createElement("p",null,"\u5bf9\u4e8e404\u9875\u9762\u6211\u4eec\u53ef\u4ee5\u518d\u8fdb\u4e00\u6b65\u62bd\u79bb\u51fa\u4e00\u4e2a",r.createElement("code",null,"notFoundException"),"\u7c7b\u3002")),r.createElement("p",null,r.createElement("code",null,"expceptions/NotFoundException.ts")),r.createElement(s.Z,{code:"import HttpException from './HttpException'\n\nclass NotFoundException extends HttpException{\n    constructor(id:string){\n        super(404,`id:${id},not found`);\n    }\n}\nexport default NotFoundException",lang:"js"}),r.createElement("p",null,"\u8fdb\u4e00\u6b65\u4fee\u6539",r.createElement("code",null,"controller")),r.createElement("p",null,r.createElement("code",null,"controllers/userController.ts")),r.createElement(s.Z,{code:"import NotFoundException from '../expceptions/NotFoundException'\n\nclass UserController{\n    static getOneById=async(req:Request,res:Response,next:NextFunction)=>{\n        const id=req.params.id;\n        User.findById(id,(err,userInfo)=>{\n            if(err){\n                next(new NotFoundException(id))\n            }else{\n                res.send(userInfo)\n            }\n        })\n    }\n}",lang:"js"}),r.createElement("p",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u2b06 back to top")),r.createElement("h1",{id:"auth"},r.createElement(o.AnchorLink,{to:"#auth","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"auth"),r.createElement("p",null,"\u672c\u6587\u6211\u4eec\u91c7\u7528",r.createElement(o.Link,{to:"https://www.npmjs.com/package/bcrypt"},"bcrypt npm \u5305"),"\u5b9e\u73b0\u7684bcrypt\u54c8\u5e0c\u7b97\u6cd5,"),r.createElement("blockquote",null,r.createElement("p",null,"npm install bcrypt npm install --save-dev @types/bcrypt")),r.createElement("p",null,"\u4e3e\u4e2a\ud83c\udf30\ud83d\udc47"),r.createElement(s.Z,{code:"const passwordInPlainText = '12345678';\nconst hashedPassword = await bcrypt.hash(passwordInPlaintext, 10);\n \nconst doPasswordsMatch = await bcrypt.compare(passwordInPlaintext, hashedPassword);\nconsole.log(doPasswordsMatch); // true",lang:"js"}),r.createElement("h2",{id:"\u767b\u5f55\u4e0e\u6ce8\u518c\u6a21\u5757"},r.createElement(o.AnchorLink,{to:"#\u767b\u5f55\u4e0e\u6ce8\u518c\u6a21\u5757","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u767b\u5f55\u4e0e\u6ce8\u518c\u6a21\u5757"),r.createElement("p",null,"\u9996\u5148\u5bf9\u7528\u6237\u521b\u5efa\u524d\u7f6e\u52a0\u5165\u5bc6\u7801\u52a0\u5bc6\u3001\u548c\u7528\u6237\u767b\u5f55\u65f6\u5bc6\u7801\u6821\u9a8c\u903b\u8f91\u3002\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u5c06\u6b64\u903b\u8f91\u52a0\u5165\u5230Model\u5c42\u3002"),r.createElement("p",null,r.createElement("code",null,"user.model.ts")),r.createElement(s.Z,{code:"userSchema.pre('save',function(next){\n    if(!this.isModified('password')){\n        return next()\n    }\n    bcrypt.hash(this.password,8,(err,hash)=>{\n        if(err){\n            return next(err)\n        }\n        this.password=hash;\n        return next();\n    })\n})\n\nuserSchema.methods.checkPassword=function(password:string){\n    const passwordHash = this.password;\n    return new Promise((resovle,reject)=>{\n        bcrypt.compare(password,passwordHash,(err,same)=>{\n            if(err) return reject(err)\n            return resovle(same)\n        })\n    })\n}",lang:"js"}),r.createElement("p",null,"\u4e0b\u9762\u6211\u4eec\u6211\u4eec\u6765\u5b9e\u73b0\u767b\u5f55\u548c\u6ce8\u518c\u6a21\u5757\u3002",r.createElement("code",null,"src/controllers/ authcontroller.ts")),r.createElement(s.Z,{code:"import { Request, Response, NextFunction } from 'express'\nimport User from '../models/user.model'\nimport NotFoundException from '../expceptions/notFoundException'\nimport HttpException from '../expceptions/httpException'\n\nclass AuthController {\n    static signup = async (req: Request, res: Response, next: NextFunction) => {\n        if (!req.body.email || !req.body.password) {\n            next(new HttpException(400, 'need email password'))\n        }\n        try {\n            const user = await User.create(req.body);\n           \n            next(new HttpException(200, token))\n        } catch (err) {\n            next(new HttpException(500, `\u6ce8\u518c\u5931\u8d25`))\n        }\n    }\n    static signin = async (req: Request, res: Response, next: NextFunction) => {\n        if (!req.body.email || !req.body.password) {\n            next(new HttpException(400, 'need email password'))\n        }\n        try {\n            const user = await User.findOne({ email: req.body.email })\n                .select('email password')\n                .exec();\n            if (!user) {\n                next(new NotFoundException(req.body.email))\n            }\n            const match = await user!.checkPassword(req.body.password);\n            if (!match) {\n                next(new HttpException(401, 'Invalid email and passoword combination'))\n            }\n        } catch (error) {\n            console.error(error, 'signin')\n            next(new HttpException(500, '\u767b\u5f55\u5931\u8d25'))\n        }\n    }\n}\nexport default AuthController",lang:"js"}),r.createElement("blockquote",null,r.createElement("p",null,"\u63d0\u793a:\u6211\u4eec\u5e76\u4e0d\u6e05\u695a\u7528\u6237\u5c1d\u8bd5\u767b\u5f55\u65f6\u662f\u7528\u6237\u540d\u8fd8\u662f\u5bc6\u7801\u9519\u8bef\u3002\u7531\u4e8e\u663e\u793a\u4e86\u4e00\u822c\u9519\u8bef\u6d88\u606f\uff0c\u56e0\u6b64\u6211\u4eec\u9632\u6b62\u4e86\u6f5c\u5728\u7684\u653b\u51fb\u8005\u4e86\u89e3\u4efb\u4f55\u6709\u6548\u7684\u7528\u6237\u540d\u4e0d\u77e5\u9053\u5bc6\u7801\u3002")),r.createElement("h2",{id:"\u4f7f\u7528jwt\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1"},r.createElement(o.AnchorLink,{to:"#\u4f7f\u7528jwt\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528JWT\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1"),r.createElement("p",null,"JWT\u662f\u4e00\u6bb5JSON\u6570\u636e\uff0c\u5728\u7528\u6237\u767b\u5f55\u540e\u4f7f\u7528\u79d8\u5bc6\u5bc6\u94a5\u5728\u6211\u4eec\u7684\u670d\u52a1\u5668\u4e0a\u7b7e\u540d\uff0c\u7136\u540e\u53d1\u9001\u7ed9\u4ed6\u3002\u5f53\u4ed6\u53d1\u51fa\u5176\u4ed6\u8bf7\u6c42\u65f6\uff0c\u4ed6\u5728\u6807\u5934\u4e2d\u53d1\u9001\u6b64\u4ee4\u724c\uff0c\u4ee5\u4fbf\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176\u8fdb\u884c\u7f16\u7801\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u94a5\u3002\u5982\u679c\u4ee4\u724c\u6709\u6548\uff0c\u5219\u6211\u4eec\u77e5\u9053\u53d1\u51fa\u8bf7\u6c42\u7684\u7528\u6237\u662f\u8c01\u3002"),r.createElement("blockquote",null,r.createElement("p",null,"npm install jsonwebtoken npm install npm install @types/jsonwebtoken")),r.createElement("p",null,r.createElement("code",null,"src/utils/auth.ts"),"\u6211\u4eec\u6839\u636e\u7528\u6237id\u521b\u5efatoken,\u6700\u540e\u5728\u6821\u9a8c\u6210\u529f\u540e\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u6b64id\u67e5\u627e\u5230\u7528\u6237\u5e76\u8fdb\u884c\u8fd4\u56de\u3002"),r.createElement(s.Z,{code:"import { secrets } from '../config'\nimport jwt from 'jsonwebtoken'\n\nexport const newToken = (user: any) => {\n    return jwt.sign({ id: user.id }, secrets.jwt, {\n        expiresIn: secrets.jwtExp\n    })\n}\nexport const verifyToken= (token: string) => {\n   return new Promise<{id:string}>((resolve, reject) => {\n        jwt.verify(token, secrets.jwt, (err, payload) => {\n            if (err) return reject(err)\n            resolve(payload as any)\n        })\n    })\n}",lang:"js"}),r.createElement("p",null,r.createElement("code",null,"src/config/index.ts")),r.createElement(s.Z,{code:"export const secrets={\n    jwt:'user',\n    jwtExp:60 * 60 // an hour\n}",lang:"js"}),r.createElement("p",null,"\u73b0\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u65b0AuthenticationController\u7684\u4ee3\u7801\u3002"),r.createElement(s.Z,{code:"import { Request, Response, NextFunction } from 'express'\nimport User from '../models/user.model'\nimport {newToken,verifyToken} from '../utils/auth'\nimport NotFoundException from '../expceptions/notFoundException'\nimport HttpException from '../expceptions/httpException'\n\n\nclass AuthController {\n    static signup = async (req: Request, res: Response, next: NextFunction) => {\n        if (!req.body.email || !req.body.password) {\n            next(new HttpException(400, 'need email password'))\n        }\n        try {\n            const user = await User.create(req.body);\n            const token = newToken(user);\n            next(new HttpException(200, token))\n        } catch (err) {\n            next(new HttpException(500, `\u6ce8\u518c\u5931\u8d25:${err}`))\n        }\n    }\n    static signin = async (req: Request, res: Response, next: NextFunction) => {\n        if (!req.body.email || !req.body.password) {\n            next(new HttpException(400, 'need email password'))\n        }\n        try {\n            const user = await User.findOne({ email: req.body.email })\n                .select('email password')\n                .exec();\n            if (!user) {\n                next(new NotFoundException(req.body.email))\n            }\n            const match = await user!.checkPassword(req.body.password);\n            if (!match) {\n                next(new HttpException(401, 'Invalid email and passoword combination'))\n            }\n            const token = newToken(user);\n            next(new HttpException(200, token))\n        } catch (error) {\n            console.error(error, 'signin')\n            next(new HttpException(500, '\u767b\u5f55\u5931\u8d25'))\n        }\n    }\n    static protect = async (req: Request, res: Response, next: NextFunction) => {\n        const bearer = req.headers.authorization;\n        if (!bearer || !bearer.startsWith('Bearer ')) {\n            next(new HttpException(401, '\u6ca1\u6709\u6743\u9650\u8bbf\u95ee'))\n        }\n        const token = bearer!.split('Bearer ')[1].trim();\n        let payload: any;\n        try {\n            payload = await verifyToken(token)\n\n        } catch (err) {\n            next(new HttpException(401, 'token \u5931\u6548'))\n        }\n\n        const user = await User.findById(payload.id)\n            .select('-password')\n            .lean()\n            .exec()\n\n        if (!user) {\n            next(new HttpException(401, 'not user'))\n        }\n        req.user = user\n        next()\n    }\n    \n}\nexport default AuthController",lang:"js"}),r.createElement("p",null,"\u6dfb\u52a0\u8def\u7531\u548c\u8bbf\u95ee\u6743\u9650",r.createElement("code",null,"/src/routes/index.ts")),r.createElement(s.Z,{code:"import { Router} from \"express\";\nimport AuthController from '../controllers/AuthController'\nimport user from './user'\n\nconst routes = Router();\n\nroutes.post('/signup',AuthController.signup)\nroutes.post('/signin',AuthController.signin)\n\nroutes.use('/api',AuthController.protect)\nroutes.use('/api/user',user)\n\nexport default routes",lang:"js"}),r.createElement("h1",{id:"\u603b\u7ed3"},r.createElement(o.AnchorLink,{to:"#\u603b\u7ed3","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3"),r.createElement("p",null,"\u5728\u672c\u6587\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5728",r.createElement("em",null,"Typescript Express"),"\u5e94\u7528\u7a0b\u5e8f\u4e2d",r.createElement("strong",null,"\u6ce8\u518c"),"\u548c",r.createElement("strong",null,"\u767b\u5f55"),"\u529f\u80fd\u3002\u8981\u5b9e\u73b0\u5b83\uff0c\u6211\u4eec\u5fc5\u987b\u77e5\u9053\u5982\u4f55\u4f7f\u7528",r.createElement("code",null,"bcrypt\u6765\u5bf9\u5bc6\u7801\u8fdb\u884c\u54c8\u5e0c\u5904\u7406"),"\u4ee5\u786e\u4fdd\u5176\u5b89\u5168\u3002 \u6211\u4eec\u5728\u8fd9\u91cc\u5b9e\u73b0\u7684\u8eab\u4efd\u9a8c\u8bc1\u662f\u4f7f\u7528JSON Web\u4ee4\u724c\uff08JWT\uff09\u5b8c\u6210\u7684\uff0c\u8be5Web\u4ee4\u724c\u63d0\u4f9b\u4e86\u4e00\u79cd\u8f7b\u677e\u7684\u65b9\u6cd5\u6765",r.createElement("code",null,"\u6807\u8bc6\u7528\u6237\u548c\u9a8c\u8bc1\u8bf7\u6c42"),"\u3002"),r.createElement("p",null,r.createElement(o.AnchorLink,{to:"#%E7%9B%AE%E5%BD%95"},"\u2b06 back to top")),r.createElement("h1",{id:"\u53c2\u8003\u5730\u5740"},r.createElement(o.AnchorLink,{to:"#\u53c2\u8003\u5730\u5740","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u5730\u5740"),r.createElement("p",null,r.createElement(o.Link,{to:"https://wanago.io/2018/12/24/typescript-express-registering-authenticating-jwt/"},"TypeScript Express tutorial #4. Registering users and authenticating with JWT")),r.createElement("h1",{id:"\u5de5\u5177"},r.createElement(o.AnchorLink,{to:"#\u5de5\u5177","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u5de5\u5177"),r.createElement("p",null,r.createElement(o.Link,{to:"https://insomnia.rest/download/"},"insomnia"),":\u4e00\u4e2a\u5f3a\u5927\u7684\u53d1\u9001\u63a5\u6536 APIs\u5de5\u5177,\u7c7b\u4f3cpostMan",r.createElement(o.Link,{to:"https://www.npmjs.com/package/morgan"},"morgan"),":nodejs HTTP \u8bf7\u6c42\u65e5\u5fd7\u4e2d\u95f4\u4ef6",r.createElement(o.Link,{to:"https://www.npmjs.com/package/cors"},"cors"),": \u53ef\u4ee5\u914d\u7f6e\u5404\u79cdcors"),r.createElement("h1",{id:"\u53c2\u8003\u6587\u6863"},r.createElement(o.AnchorLink,{to:"#\u53c2\u8003\u6587\u6863","aria-hidden":"true",tabIndex:-1},r.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u6587\u6863"),r.createElement("p",null,r.createElement(o.Link,{to:"https://restful-api-node-typescript.books.dalenguyen.me/en/latest/index.html#"},"restful-api-node-typescript")))))}}]);